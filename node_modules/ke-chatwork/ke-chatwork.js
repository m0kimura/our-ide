'use strict';
const keUtility=require('ke-utility');
module.exports=class keChatwork extends keUtility {
//
  constructor(token) {
    super();
    this.Option={};
    this.Option.headers={
      'X-ChatWorkToken':token,
      'Content-Type': 'application/json'
    };
    this.Option.hostname='api.chatwork.com';
  }
//
  getRooms() {
    let op=this.Option, rc;
    op.path='/v2/rooms';
    rc=this.getRequest(op, true, true);
    this.Rooms={};
    for(let i in rc){
      this.Rooms[rc[i].name]=rc[i].room_id;
    }
    return this.Rooms;
  }
//
  pushMessage(msg, room) {
    let op=this.Option, rc;
    if(!this.Rooms){this.getRooms();}
    let rid = this.Rooms[room];
    if(rid){
      op.path='/v2/rooms/'+rid+'/messages?body='+msg;
      rc=this.postRequest(op, {}, true);
      if(rc){return true;}else{return false;}
    }else{
      this.error='room('+room+') can not be found !!';
      return false;
    }
  }
};
